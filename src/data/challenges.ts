export interface ChallengeStep {
  id: number;
  title: string;
  instruction: string;
  hint: string;
  type: 'multiple-choice' | 'fill-blank' | 'ordering' | 'config' | 'checkbox';
  // For multiple-choice
  options?: string[];
  correctAnswer?: number; // index
  // For fill-blank
  placeholder?: string;
  acceptedAnswers?: string[];
  // For ordering
  items?: string[];
  correctOrder?: number[];
  // For checkbox (multi-select)
  checkboxOptions?: string[];
  correctChecks?: number[];
  // For config (key-value pairs)
  configFields?: { label: string; placeholder: string; acceptedAnswers: string[] }[];
  explanation: string;
}

export interface Challenge {
  id: string;
  title: string;
  description: string;
  difficulty: 'Beginner' | 'Intermediate' | 'Advanced';
  type: 'guided' | 'timed' | 'puzzle' | 'debug';
  timeLimit?: number; // minutes
  xp: number;
  icon: string;
  steps: ChallengeStep[];
  completionMessage: string;
}

export const dailyChallenge: Challenge = {
  id: 'daily-webhook-slack',
  title: 'Build a Webhook ‚Üí Slack Notification',
  description: 'Create a workflow that receives webhook data and sends a formatted message to a Slack channel.',
  difficulty: 'Beginner',
  type: 'guided',
  timeLimit: 15,
  xp: 150,
  icon: 'üóìÔ∏è',
  steps: [
    {
      id: 1,
      title: 'Choose the trigger',
      instruction: 'Every n8n workflow starts with a trigger. Which node should you use to receive data from an external service?',
      hint: 'A webhook is a URL that listens for incoming HTTP requests.',
      type: 'multiple-choice',
      options: ['Schedule Trigger', 'Webhook', 'Manual Trigger', 'Email Trigger'],
      correctAnswer: 1,
      explanation: 'The Webhook node creates a URL that listens for incoming HTTP requests ‚Äî perfect for receiving data from external services in real time.',
    },
    {
      id: 2,
      title: 'Configure the webhook method',
      instruction: 'Which HTTP method should you set on your Webhook node to receive JSON data from an external app?',
      hint: 'When sending data TO a server, we typically use the method that "posts" information.',
      type: 'multiple-choice',
      options: ['GET', 'POST', 'PUT', 'DELETE'],
      correctAnswer: 1,
      explanation: 'POST is used to send data to the server. External services will POST JSON data to your webhook URL.',
    },
    {
      id: 3,
      title: 'Extract the message',
      instruction: 'The webhook receives this JSON: `{ "event": "new_lead", "name": "Marie", "email": "marie@test.com" }`. Write the expression to access the name field.',
      hint: 'In n8n, you access incoming JSON data with {{ $json.fieldName }}',
      type: 'fill-blank',
      placeholder: '{{ $json.??? }}',
      acceptedAnswers: ['{{ $json.name }}', '{{$json.name}}', '$json.name'],
      explanation: '{{ $json.name }} accesses the "name" field from the incoming JSON payload. The $json variable represents the current item\'s data.',
    },
    {
      id: 4,
      title: 'Configure the Slack message',
      instruction: 'Now configure the Slack node. Fill in the channel and the message text using expressions.',
      hint: 'Use #general for the channel, and reference $json fields for dynamic content.',
      type: 'config',
      configFields: [
        { label: 'Channel', placeholder: '#channel-name', acceptedAnswers: ['#general', 'general', '#notifications'] },
        { label: 'Message', placeholder: 'New lead: ...', acceptedAnswers: ['New lead: {{ $json.name }}', '{{ $json.name }}', 'New lead: {{ $json.name }} ({{ $json.email }})'] },
      ],
      explanation: 'The Slack node sends messages to a specified channel. Using expressions like {{ $json.name }} makes the message dynamic based on the webhook data.',
    },
    {
      id: 5,
      title: 'Order the workflow',
      instruction: 'Put these nodes in the correct execution order for the workflow:',
      hint: 'Think about the data flow: receive ‚Üí process ‚Üí send.',
      type: 'ordering',
      items: ['Slack (Send Message)', 'Webhook (Receive Data)', 'Set Node (Format Message)'],
      correctOrder: [1, 2, 0],
      explanation: 'The correct order is: Webhook (receives data) ‚Üí Set Node (formats it) ‚Üí Slack (sends the message). Data flows from left to right in n8n.',
    },
  ],
  completionMessage: 'üéâ Amazing! You\'ve built a webhook-to-Slack notification workflow. This pattern is the foundation of most real-time integrations!',
};

export const challenges: Challenge[] = [
  {
    id: 'connect-webhook',
    title: 'Connect Your First Webhook',
    description: 'Learn how webhooks work by setting one up step by step.',
    difficulty: 'Beginner',
    type: 'guided',
    timeLimit: 5,
    xp: 100,
    icon: 'üîó',
    steps: [
      {
        id: 1,
        title: 'What is a webhook?',
        instruction: 'A webhook is a way for one app to send real-time data to another. Which analogy best describes a webhook?',
        hint: 'Think about receiving deliveries at your door vs going to the post office.',
        type: 'multiple-choice',
        options: [
          'A phone call you make to ask for info',
          'A doorbell ‚Äî it notifies you when something arrives',
          'A scheduled alarm that goes off every hour',
          'A filing cabinet that stores data',
        ],
        correctAnswer: 1,
        explanation: 'A webhook is like a doorbell ‚Äî it\'s a passive listener that notifies your workflow when new data arrives, rather than you having to check repeatedly (polling).',
      },
      {
        id: 2,
        title: 'Create the Webhook node',
        instruction: 'In n8n, which type of node is a Webhook?',
        hint: 'It\'s the starting point of a workflow that waits for external data.',
        type: 'multiple-choice',
        options: ['Action node', 'Trigger node', 'Transform node', 'Output node'],
        correctAnswer: 1,
        explanation: 'The Webhook is a Trigger node ‚Äî it starts your workflow when it receives an HTTP request. Every workflow needs exactly one trigger.',
      },
      {
        id: 3,
        title: 'Choose the right path',
        instruction: 'Your webhook receives customer data. You want to save new customers but ignore existing ones. Which node do you add after the Webhook?',
        hint: 'You need to make a decision based on a condition.',
        type: 'multiple-choice',
        options: ['Set Node', 'IF Node', 'Merge Node', 'Code Node'],
        correctAnswer: 1,
        explanation: 'The IF node lets you create conditional logic ‚Äî checking if a customer is new or existing, and routing the data accordingly.',
      },
    ],
    completionMessage: 'üîó Great job! You understand how webhooks work. They\'re the backbone of real-time automation!',
  },
  {
    id: 'json-parser',
    title: 'Build a JSON Parser',
    description: 'Parse, extract, and transform JSON data like a pro.',
    difficulty: 'Beginner',
    type: 'guided',
    timeLimit: 10,
    xp: 120,
    icon: 'üìã',
    steps: [
      {
        id: 1,
        title: 'Identify JSON structure',
        instruction: 'Look at this JSON: `{ "user": { "name": "Alex", "skills": ["n8n", "zapier"] } }`. How do you access the name?',
        hint: 'Nested objects use dot notation.',
        type: 'fill-blank',
        placeholder: '{{ $json.??? }}',
        acceptedAnswers: ['{{ $json.user.name }}', '{{$json.user.name}}', '$json.user.name'],
        explanation: 'Use dot notation to access nested values: $json.user.name navigates into the "user" object and retrieves "name".',
      },
      {
        id: 2,
        title: 'Access array elements',
        instruction: 'From the same JSON, how do you access the first skill ("n8n")?',
        hint: 'Arrays use bracket notation with an index starting at 0.',
        type: 'fill-blank',
        placeholder: '{{ $json.??? }}',
        acceptedAnswers: ['{{ $json.user.skills[0] }}', '{{$json.user.skills[0]}}', '$json.user.skills[0]'],
        explanation: 'Arrays are zero-indexed, so skills[0] gets "n8n" (the first element) and skills[1] would get "zapier".',
      },
      {
        id: 3,
        title: 'Transform the data',
        instruction: 'You need to create a "summary" field that combines name and first skill. Which Set node configuration is correct?',
        hint: 'Use string concatenation with expressions.',
        type: 'multiple-choice',
        options: [
          'summary = {{ $json.name }} knows {{ $json.skills }}',
          'summary = {{ $json.user.name }} knows {{ $json.user.skills[0] }}',
          'summary = $json.user.name + $json.user.skills',
          'summary = {{ $json.user }} knows {{ $json.skills[0] }}',
        ],
        correctAnswer: 1,
        explanation: 'The correct path is $json.user.name and $json.user.skills[0], wrapped in {{ }} expressions to evaluate them in the Set node.',
      },
      {
        id: 4,
        title: 'Handle missing data',
        instruction: 'What happens if you try to access {{ $json.user.phone }} and that field doesn\'t exist?',
        hint: 'Think about what "undefined" means in programming.',
        type: 'multiple-choice',
        options: [
          'The workflow crashes',
          'It returns "undefined" and continues',
          'It returns an empty string',
          'It skips the entire node',
        ],
        correctAnswer: 1,
        explanation: 'Accessing a non-existent field returns "undefined". The workflow continues, but you should handle this with IF nodes or default values to avoid passing bad data downstream.',
      },
    ],
    completionMessage: 'üìã You\'re now a JSON parsing expert! This skill is essential for every single n8n workflow.',
  },
  {
    id: 'email-sorter',
    title: 'Create a Conditional Email Sorter',
    description: 'Build logic to sort incoming emails into categories using IF and Switch nodes.',
    difficulty: 'Beginner',
    type: 'guided',
    timeLimit: 15,
    xp: 150,
    icon: 'üìß',
    steps: [
      {
        id: 1,
        title: 'Choose the trigger',
        instruction: 'You want to automatically sort emails as they arrive. Which trigger should you use?',
        hint: 'You want to react to new emails coming into your inbox.',
        type: 'multiple-choice',
        options: ['Webhook Trigger', 'Schedule Trigger', 'Gmail Trigger (on new email)', 'Manual Trigger'],
        correctAnswer: 2,
        explanation: 'The Gmail Trigger fires every time a new email arrives, making it perfect for real-time email processing.',
      },
      {
        id: 2,
        title: 'Define sorting categories',
        instruction: 'Select all the categories you\'d want to sort emails into (select all that apply):',
        hint: 'Think about common email types in a business context.',
        type: 'checkbox',
        checkboxOptions: ['Urgent / High Priority', 'Client Inquiries', 'Newsletters / Marketing', 'Internal Team', 'Spam / Irrelevant'],
        correctChecks: [0, 1, 2, 3, 4],
        explanation: 'All of these are valid categories! A good email sorter handles all types. In n8n, you\'d use a Switch node to route emails to different paths based on rules.',
      },
      {
        id: 3,
        title: 'Build the condition',
        instruction: 'To check if an email subject contains "URGENT", which expression would you use in an IF node?',
        hint: 'String methods like .includes() or .contains() can check for substrings.',
        type: 'multiple-choice',
        options: [
          '{{ $json.subject }} === "URGENT"',
          '{{ $json.subject.includes("URGENT") }}',
          '{{ $json.from }} contains "URGENT"',
          '{{ $json.body.startsWith("URGENT") }}',
        ],
        correctAnswer: 1,
        explanation: '$json.subject.includes("URGENT") checks if the subject line contains the word "URGENT" anywhere. This is more flexible than exact matching.',
      },
      {
        id: 4,
        title: 'Route the workflow',
        instruction: 'You have 4 categories. Which node is better than chaining multiple IF nodes?',
        hint: 'There\'s a node designed specifically for multiple conditions/routes.',
        type: 'multiple-choice',
        options: ['Merge Node', 'Switch Node', 'Code Node', 'Set Node'],
        correctAnswer: 1,
        explanation: 'The Switch node handles multiple conditions in one node, routing data to different outputs. Much cleaner than chaining IF ‚Üí IF ‚Üí IF!',
      },
      {
        id: 5,
        title: 'Complete the workflow order',
        instruction: 'Arrange the nodes for the complete email sorting workflow:',
        hint: 'Trigger ‚Üí Sort ‚Üí Act on each category.',
        type: 'ordering',
        items: ['Add Label in Gmail', 'Gmail Trigger', 'Switch Node (categorize)', 'Set Node (add metadata)'],
        correctOrder: [1, 3, 2, 0],
        explanation: 'Gmail Trigger ‚Üí Set Node (extract/format key data) ‚Üí Switch Node (categorize by rules) ‚Üí Add Label (organize the email).',
      },
    ],
    completionMessage: 'üìß Excellent! You\'ve designed an intelligent email sorter. This pattern works for any kind of data classification!',
  },
  {
    id: 'lead-capture',
    title: 'Build a Lead Capture System',
    description: 'Create a complete lead capture pipeline: webhook ‚Üí validation ‚Üí storage ‚Üí notification.',
    difficulty: 'Intermediate',
    type: 'guided',
    timeLimit: 20,
    xp: 200,
    icon: 'üéØ',
    steps: [
      {
        id: 1,
        title: 'Design the data flow',
        instruction: 'Order these steps for a lead capture system:',
        hint: 'Think: receive ‚Üí validate ‚Üí store ‚Üí notify.',
        type: 'ordering',
        items: ['Send Slack notification', 'Validate email format', 'Webhook receives form data', 'Save to Google Sheets'],
        correctOrder: [2, 1, 3, 0],
        explanation: 'Webhook (receive) ‚Üí Validate (check data quality) ‚Üí Google Sheets (persist) ‚Üí Slack (alert your team). Always validate before storing!',
      },
      {
        id: 2,
        title: 'Validate the email',
        instruction: 'Which expression checks if an email field contains "@" and "."?',
        hint: 'You can use .includes() multiple times or use a regex pattern.',
        type: 'multiple-choice',
        options: [
          '{{ $json.email.includes("@") && $json.email.includes(".") }}',
          '{{ $json.email === "valid" }}',
          '{{ $json.email.length > 5 }}',
          '{{ $json.email.isEmail() }}',
        ],
        correctAnswer: 0,
        explanation: 'Checking for "@" and "." is a basic email validation. In production, you might use a regex or a dedicated validation service.',
      },
      {
        id: 3,
        title: 'Configure Google Sheets',
        instruction: 'Set up the Google Sheets node to store leads. Fill in the field mappings:',
        hint: 'Map each form field to a spreadsheet column.',
        type: 'config',
        configFields: [
          { label: 'Name Column', placeholder: 'Expression for name...', acceptedAnswers: ['{{ $json.name }}', '$json.name'] },
          { label: 'Email Column', placeholder: 'Expression for email...', acceptedAnswers: ['{{ $json.email }}', '$json.email'] },
          { label: 'Date Column', placeholder: 'Expression for date...', acceptedAnswers: ['{{ $now }}', '{{ new Date() }}', '$now', '{{ $json.date }}'] },
        ],
        explanation: 'Map each incoming field to a spreadsheet column. The $now variable gives you the current timestamp for tracking when the lead was captured.',
      },
      {
        id: 4,
        title: 'Error handling',
        instruction: 'What should happen if the Google Sheets API fails?',
        hint: 'You don\'t want to lose the lead data even if storage fails.',
        type: 'multiple-choice',
        options: [
          'Ignore the error and continue',
          'Stop the workflow immediately',
          'Use an Error Trigger to retry and send an alert',
          'Delete the lead data',
        ],
        correctAnswer: 2,
        explanation: 'The Error Trigger catches failures and lets you retry the operation or alert your team. Never silently lose data!',
      },
    ],
    completionMessage: 'üéØ You\'ve built a production-ready lead capture system! This is one of the most requested automation services.',
  },
  {
    id: 'fix-workflow',
    title: 'Fix This Broken Workflow',
    description: 'Find and fix 3 bugs in a broken email automation workflow.',
    difficulty: 'Intermediate',
    type: 'debug',
    timeLimit: 10,
    xp: 180,
    icon: 'üêõ',
    steps: [
      {
        id: 1,
        title: 'Bug #1: Wrong trigger',
        instruction: 'This workflow should fire when a new row is added to Google Sheets, but it\'s using a Schedule Trigger (runs every hour). What\'s the problem with this approach?',
        hint: 'Think about latency ‚Äî how long could a new lead wait?',
        type: 'multiple-choice',
        options: [
          'Nothing wrong, Schedule is fine',
          'New leads could wait up to 59 minutes before being processed',
          'Schedule Trigger can\'t read Google Sheets',
          'It will use too many API calls',
        ],
        correctAnswer: 1,
        explanation: 'With a Schedule Trigger, new leads could wait up to 59 minutes. Switch to a Google Sheets Trigger or a Webhook for near-instant processing.',
      },
      {
        id: 2,
        title: 'Bug #2: Expression error',
        instruction: 'The Set node uses `{{ $json.user.email }}` but the incoming data structure is `{ "email": "test@mail.com", "name": "Test" }`. What\'s wrong?',
        hint: 'Look carefully at the JSON structure ‚Äî is "email" nested under "user"?',
        type: 'fill-blank',
        placeholder: 'Correct expression: {{ $json.??? }}',
        acceptedAnswers: ['{{ $json.email }}', '{{$json.email}}', '$json.email'],
        explanation: 'The email is at the root level, not nested under "user". The correct expression is {{ $json.email }}. Always check your data structure in the input panel!',
      },
      {
        id: 3,
        title: 'Bug #3: Missing error handling',
        instruction: 'The workflow sends an email but has no error handling. If the email service is down, what happens?',
        hint: 'Without error handling, failures are silent.',
        type: 'multiple-choice',
        options: [
          'n8n automatically retries',
          'The workflow stops and the execution fails silently',
          'The email gets queued',
          'The data is automatically saved for later',
        ],
        correctAnswer: 1,
        explanation: 'Without error handling, the workflow fails and you won\'t know about it. Add an Error Trigger node to catch failures and alert you!',
      },
    ],
    completionMessage: 'üêõ Bug hunter! You\'ve identified and fixed 3 common workflow issues. Debugging skills are crucial for production automations.',
  },
  {
    id: 'slack-bot',
    title: 'Create a Slack Bot',
    description: 'Build a Slack bot that responds to messages with AI-generated answers.',
    difficulty: 'Intermediate',
    type: 'guided',
    timeLimit: 25,
    xp: 250,
    icon: 'üí¨',
    steps: [
      {
        id: 1,
        title: 'Choose the trigger',
        instruction: 'To make a bot that responds to Slack messages, which trigger do you need?',
        hint: 'You need to listen for new messages in a Slack channel.',
        type: 'multiple-choice',
        options: ['Webhook', 'Slack Trigger (on new message)', 'Schedule Trigger', 'Manual Trigger'],
        correctAnswer: 1,
        explanation: 'The Slack Trigger fires when a new message is posted. You can filter by channel, user, or keywords.',
      },
      {
        id: 2,
        title: 'Filter bot messages',
        instruction: 'Your bot shouldn\'t respond to its own messages (infinite loop!). What check do you add?',
        hint: 'Check if the message sender is the bot itself.',
        type: 'multiple-choice',
        options: [
          'Check if message length > 0',
          'Check if sender is NOT the bot user ID',
          'Check if the channel is public',
          'Check if the message has attachments',
        ],
        correctAnswer: 1,
        explanation: 'Always filter out the bot\'s own messages to prevent infinite loops! Use an IF node: $json.user !== "BOT_USER_ID".',
      },
      {
        id: 3,
        title: 'Add AI response',
        instruction: 'Which node generates an AI response to the user\'s question?',
        hint: 'You need a node that can call a Large Language Model.',
        type: 'multiple-choice',
        options: ['Set Node', 'HTTP Request (to OpenAI)', 'Code Node', 'Merge Node'],
        correctAnswer: 1,
        explanation: 'The HTTP Request node calls the OpenAI API with the user\'s message as a prompt and returns the AI-generated response.',
      },
      {
        id: 4,
        title: 'Build the workflow',
        instruction: 'Order the complete workflow:',
        hint: 'Listen ‚Üí Filter ‚Üí Think ‚Üí Reply.',
        type: 'ordering',
        items: ['Slack: Send Reply', 'IF: Not Bot Message', 'OpenAI: Generate Response', 'Slack Trigger: New Message'],
        correctOrder: [3, 1, 2, 0],
        explanation: 'Slack Trigger ‚Üí IF (filter bot messages) ‚Üí OpenAI (generate reply) ‚Üí Slack Send (post response). Clean and effective!',
      },
      {
        id: 5,
        title: 'Handle rate limits',
        instruction: 'OpenAI has rate limits. What\'s the best way to handle this in your workflow?',
        hint: 'Think about what happens when you exceed the API limit.',
        type: 'multiple-choice',
        options: [
          'Ignore errors and hope for the best',
          'Add a Wait node with retry logic and error handling',
          'Send all messages at once',
          'Remove the AI node when rate limited',
        ],
        correctAnswer: 1,
        explanation: 'Add retry logic with exponential backoff. The Wait node can pause before retrying, and Error Handling ensures you catch and manage failures gracefully.',
      },
    ],
    completionMessage: 'üí¨ Your AI Slack bot is ready! This is a high-value automation that companies pay for.',
  },
  {
    id: 'ai-email-responder',
    title: 'Build an AI Email Responder',
    description: 'Create an intelligent email responder that classifies emails and generates contextual replies.',
    difficulty: 'Advanced',
    type: 'guided',
    timeLimit: 30,
    xp: 300,
    icon: 'ü§ñ',
    steps: [
      {
        id: 1,
        title: 'Design the classification system',
        instruction: 'Before building, plan your email categories. Select all that an AI classifier should handle:',
        hint: 'Think about the types of emails a business receives daily.',
        type: 'checkbox',
        checkboxOptions: ['Support requests', 'Sales inquiries', 'Meeting requests', 'Spam/Marketing', 'Urgent issues'],
        correctChecks: [0, 1, 2, 3, 4],
        explanation: 'A robust classifier handles all common categories. The AI will analyze email content and assign a category before generating a response.',
      },
      {
        id: 2,
        title: 'Build the classification prompt',
        instruction: 'Which prompt engineering technique is best for email classification?',
        hint: 'You want consistent, structured output from the AI.',
        type: 'multiple-choice',
        options: [
          'Just say "classify this email"',
          'Provide categories, examples, and ask for JSON output',
          'Let the AI decide its own categories',
          'Use a single word prompt',
        ],
        correctAnswer: 1,
        explanation: 'Few-shot prompting with examples and structured JSON output gives the most reliable classification. Always specify the exact format you want!',
      },
      {
        id: 3,
        title: 'Configure the response generation',
        instruction: 'For the AI response node, what should you include in the system prompt?',
        hint: 'The system prompt sets the AI\'s behavior and constraints.',
        type: 'config',
        configFields: [
          { label: 'Role', placeholder: 'You are a...', acceptedAnswers: ['customer support agent', 'professional assistant', 'email responder', 'support agent'] },
          { label: 'Tone', placeholder: 'Professional, friendly...', acceptedAnswers: ['professional', 'friendly', 'professional and friendly', 'helpful'] },
        ],
        explanation: 'A good system prompt defines the AI\'s role, tone, and constraints. This ensures consistent, on-brand responses.',
      },
      {
        id: 4,
        title: 'Add safety checks',
        instruction: 'Before sending an AI-generated response, what safety measure should you add?',
        hint: 'AI can hallucinate or generate inappropriate content.',
        type: 'multiple-choice',
        options: [
          'Send immediately ‚Äî AI is always right',
          'Add a human review step for sensitive categories',
          'Only respond to emails with attachments',
          'Limit responses to 10 words',
        ],
        correctAnswer: 1,
        explanation: 'Always add human review for sensitive or high-stakes emails. You can auto-respond to simple queries but flag complex ones for manual review.',
      },
      {
        id: 5,
        title: 'Order the complete workflow',
        instruction: 'Arrange the full AI email responder workflow:',
        hint: 'Receive ‚Üí Classify ‚Üí Generate ‚Üí Review ‚Üí Send.',
        type: 'ordering',
        items: ['Send Reply via Gmail', 'Gmail Trigger', 'OpenAI: Classify Email', 'OpenAI: Generate Response', 'IF: Needs Human Review?'],
        correctOrder: [1, 2, 3, 4, 0],
        explanation: 'Gmail Trigger ‚Üí Classify ‚Üí Generate Response ‚Üí Check if review needed ‚Üí Send. This creates a robust, safe email automation.',
      },
    ],
    completionMessage: 'ü§ñ Incredible! You\'ve built an AI-powered email responder. This is a premium automation service worth $2,000+ for clients!',
  },
  {
    id: 'approval-workflow',
    title: 'Multi-Step Approval Workflow',
    description: 'Build a complete approval system with multiple reviewers, escalation, and audit logging.',
    difficulty: 'Advanced',
    type: 'guided',
    timeLimit: 45,
    xp: 400,
    icon: '‚úÖ',
    steps: [
      {
        id: 1,
        title: 'Design the approval chain',
        instruction: 'An expense report over $1000 needs manager AND director approval. Under $1000 needs only manager. Which node handles this routing?',
        hint: 'You need conditional branching based on the amount.',
        type: 'multiple-choice',
        options: ['Merge Node', 'Switch Node', 'IF Node', 'Set Node'],
        correctAnswer: 2,
        explanation: 'The IF node checks the amount: if > $1000, route to the multi-approval path; otherwise, route to single approval. Simple and effective.',
      },
      {
        id: 2,
        title: 'Implement the wait mechanism',
        instruction: 'After sending an approval request, how do you pause the workflow until the manager responds?',
        hint: 'n8n has a special mechanism for waiting for external events.',
        type: 'multiple-choice',
        options: [
          'Use a Schedule node to check every minute',
          'Use a Wait node with webhook resume',
          'Use a Loop node to keep checking',
          'End the workflow and start a new one',
        ],
        correctAnswer: 1,
        explanation: 'The Wait node can pause execution and resume when a webhook is called ‚Äî perfect for approval flows where you need human input.',
      },
      {
        id: 3,
        title: 'Handle timeout / escalation',
        instruction: 'If the manager doesn\'t respond within 24 hours, what should happen?',
        hint: 'You don\'t want requests stuck forever.',
        type: 'checkbox',
        checkboxOptions: ['Send a reminder to the manager', 'Escalate to their supervisor', 'Auto-reject after 48 hours', 'Log the timeout event'],
        correctChecks: [0, 1, 2, 3],
        explanation: 'All of these are valid escalation strategies! A robust approval system handles timeouts gracefully with reminders, escalation, and audit trails.',
      },
      {
        id: 4,
        title: 'Build the complete flow',
        instruction: 'Order the approval workflow steps:',
        hint: 'Submit ‚Üí Route ‚Üí Approve ‚Üí Notify ‚Üí Log.',
        type: 'ordering',
        items: ['Log decision to database', 'Webhook: Receive request', 'IF: Amount > $1000?', 'Send approval email', 'Wait for response'],
        correctOrder: [1, 2, 3, 4, 0],
        explanation: 'Webhook ‚Üí IF (route by amount) ‚Üí Email approval request ‚Üí Wait for response ‚Üí Log the decision. Clean multi-step approval!',
      },
    ],
    completionMessage: '‚úÖ You\'ve mastered approval workflows! These systems are essential for enterprise automation and are highly valued by clients.',
  },

  {
    id: 'schedule-sync',
    title: 'Daily Data Sync with Schedule Trigger',
    description: 'Build an automated daily sync that pulls data from an API and updates a Google Sheet every morning.',
    difficulty: 'Intermediate',
    type: 'guided',
    timeLimit: 20,
    xp: 200,
    icon: 'üïó',
    steps: [
      {
        id: 1,
        title: 'Set up the Schedule Trigger',
        instruction: 'You want the sync to run every weekday at 8am. Which cron expression is correct?',
        hint: 'Cron format: minute hour day month weekday. Weekdays are 1-5 (Mon-Fri).',
        type: 'multiple-choice',
        options: [
          '0 8 * * 1-5',
          '8 0 * * *',
          '* 8 * * 1-5',
          '0 8 1-5 * *',
        ],
        correctAnswer: 0,
        explanation: '"0 8 * * 1-5" means: at minute 0, hour 8, any day of month, any month, weekdays 1-5 (Mon-Fri). This fires at exactly 8:00am every weekday.',
      },
      {
        id: 2,
        title: 'Configure the HTTP Request',
        instruction: 'You\'re fetching data from a public API. The URL is `https://api.example.com/data` and requires an API key as a query parameter. How do you add it?',
        hint: 'Query parameters are added after "?" in the URL or in the query params section.',
        type: 'multiple-choice',
        options: [
          'Add it in the request body as JSON',
          'Add it in the URL as ?api_key=YOUR_KEY or in the Query Parameters section',
          'Add it as a custom header called "API-Key"',
          'You don\'t need to ‚Äî APIs don\'t require keys',
        ],
        correctAnswer: 1,
        explanation: 'Many APIs use query parameters for authentication. You can add them directly to the URL or use the "Query Parameters" section in the HTTP Request node for cleaner configuration.',
      },
      {
        id: 3,
        title: 'Handle the response array',
        instruction: 'The API returns an array of 50 items: `[{"id":1,"name":"A"},{"id":2,"name":"B"},...]`. How does n8n process this?',
        hint: 'n8n automatically splits arrays into individual items.',
        type: 'multiple-choice',
        options: [
          'It processes the entire array as one item',
          'It automatically splits the array ‚Äî each object becomes a separate item',
          'You need a Loop node to process each item',
          'It only processes the first item',
        ],
        correctAnswer: 1,
        explanation: 'n8n automatically splits JSON arrays into individual items. The next node receives each item separately, making it easy to process each one without a Loop node.',
      },
      {
        id: 4,
        title: 'Write to Google Sheets efficiently',
        instruction: 'You have 50 items and need to update the sheet. Which Google Sheets operation should you use to add new rows?',
        hint: 'You want to add rows, not overwrite the entire sheet.',
        type: 'multiple-choice',
        options: ['Clear & Replace', 'Append Row', 'Update Row', 'Create Spreadsheet'],
        correctAnswer: 1,
        explanation: '"Append Row" adds a new row at the bottom of the sheet for each item. "Clear & Replace" would wipe the existing data first, which is only appropriate for full refreshes.',
      },
      {
        id: 5,
        title: 'Add a completion notification',
        instruction: 'After all rows are written, you want a summary Slack message: "Daily sync complete: 50 items updated." Which n8n variable gives you the count of processed items?',
        hint: 'Check the items count from the previous node.',
        type: 'fill-blank',
        placeholder: '{{ $????.length }} items updated',
        acceptedAnswers: ['{{ $items().length }}', '{{ $input.all().length }}', '$items().length'],
        explanation: '$items().length gives you the count of items processed by the current node. Use it in your Slack message to report on the sync results.',
      },
    ],
    completionMessage: 'üïó Your daily sync runs automatically every weekday at 8am! This is the foundation of all data pipeline automations.',
  },

  {
    id: 'http-api-builder',
    title: 'Build a Multi-API Data Aggregator',
    description: 'Call 3 different APIs, merge their data, and create a unified dashboard report.',
    difficulty: 'Intermediate',
    type: 'guided',
    timeLimit: 25,
    xp: 225,
    icon: 'üåê',
    steps: [
      {
        id: 1,
        title: 'Authentication methods',
        instruction: 'API 1 uses a Bearer token, API 2 uses a Basic Auth (user:pass), API 3 uses an API key in the header. Match each to the correct Header configuration:',
        hint: 'Bearer tokens go in Authorization: Bearer TOKEN. Basic uses base64 encoding.',
        type: 'ordering',
        items: [
          'Header: Authorization ‚Üí Value: Basic base64(user:pass)',
          'Header: Authorization ‚Üí Value: Bearer sk-abc123',
          'Header: X-API-Key ‚Üí Value: api_key_here',
        ],
        correctOrder: [1, 0, 2],
        explanation: 'API 1 (Bearer): Authorization: Bearer TOKEN. API 2 (Basic): Authorization: Basic BASE64. API 3 (Key header): X-API-Key: YOUR_KEY. Each auth method has a different pattern.',
      },
      {
        id: 2,
        title: 'Parallel API calls',
        instruction: 'You want to call all 3 APIs at the same time to reduce total time. What\'s the correct approach in n8n?',
        hint: 'n8n executes branches in parallel by default.',
        type: 'multiple-choice',
        options: [
          'Chain 3 HTTP nodes sequentially',
          'Add all 3 HTTP nodes connected to the same trigger ‚Äî n8n runs them in parallel',
          'Use a Loop node to call each API one by one',
          'You can\'t run parallel requests in n8n',
        ],
        correctAnswer: 1,
        explanation: 'When multiple nodes connect to the same trigger output, n8n executes them in parallel. This halves (or thirds!) the total execution time compared to sequential calls.',
      },
      {
        id: 3,
        title: 'Merge the results',
        instruction: 'After 3 parallel API calls, you have 3 separate data streams. Which node combines them into one?',
        hint: 'You need to join multiple data streams.',
        type: 'multiple-choice',
        options: ['Set Node', 'IF Node', 'Merge Node', 'Loop Over Items'],
        correctAnswer: 2,
        explanation: 'The Merge node combines data from multiple input paths. Use "Append" mode to collect all items from all 3 APIs into a single stream for the next node.',
      },
      {
        id: 4,
        title: 'Calculate a metric',
        instruction: 'From the merged data you have a "revenue" field from API 1 and a "cost" field from API 2. Write the expression for profit margin:',
        hint: 'Profit margin = (revenue - cost) / revenue √ó 100',
        type: 'fill-blank',
        placeholder: '{{ (($json.??? - $json.???) / $json.???) * 100 }}',
        acceptedAnswers: [
          '{{ (($json.revenue - $json.cost) / $json.revenue) * 100 }}',
          '{{(($json.revenue - $json.cost) / $json.revenue) * 100}}',
          '(($json.revenue - $json.cost) / $json.revenue) * 100',
        ],
        explanation: 'Profit margin formula in n8n expression: (revenue - cost) / revenue √ó 100. The {{ }} wrapper evaluates this as JavaScript.',
      },
      {
        id: 5,
        title: 'Format the report',
        instruction: 'Select all the information a good daily API report should include:',
        hint: 'Think about what a manager needs to see at a glance.',
        type: 'checkbox',
        checkboxOptions: [
          'Timestamp of when the report was generated',
          'Key metrics from each API',
          'Trend compared to yesterday',
          'Any errors or missing data',
          'Total execution time of the workflow',
        ],
        correctChecks: [0, 1, 2, 3, 4],
        explanation: 'A great report includes all of these! Timestamp for context, metrics for information, trends for insight, errors for reliability, and execution time to monitor performance.',
      },
    ],
    completionMessage: 'üåê You built a multi-API data aggregator! This is the backbone of business intelligence dashboards and reporting systems.',
  },

  {
    id: 'notion-automator',
    title: 'Notion Database Automation',
    description: 'Automate your Notion workspace ‚Äî sync data, update pages, and create AI-generated summaries.',
    difficulty: 'Intermediate',
    type: 'guided',
    timeLimit: 30,
    xp: 250,
    icon: 'üìù',
    steps: [
      {
        id: 1,
        title: 'Notion API basics',
        instruction: 'To connect n8n to Notion, what do you need first?',
        hint: 'All Notion API access requires a specific type of application.',
        type: 'multiple-choice',
        options: [
          'Your Notion password',
          'A Notion Integration (Internal Integration Token)',
          'A Notion Pro account',
          'The Notion desktop app',
        ],
        correctAnswer: 1,
        explanation: 'You must create a Notion Integration at notion.so/my-integrations. This gives you an Internal Integration Token. Then share your database with the integration to grant access.',
      },
      {
        id: 2,
        title: 'Query a Notion database',
        instruction: 'You want to get all Notion pages where the "Status" property equals "In Progress". What does this require?',
        hint: 'The Notion API supports filtering by property values.',
        type: 'multiple-choice',
        options: [
          'Get all pages and filter with an IF node',
          'Use the Notion node "Query Database" with a filter',
          'Manually check each page',
          'Use the Notion node "Get Page" on each ID',
        ],
        correctAnswer: 1,
        explanation: 'The Notion "Query Database" operation supports server-side filtering. This is much more efficient than getting all pages and filtering locally ‚Äî Notion returns only the pages you need.',
      },
      {
        id: 3,
        title: 'Update a Notion property',
        instruction: 'A task is completed. You need to update the "Status" property from "In Progress" to "Done" and set a "Completed At" date. Which Notion operation do you use?',
        hint: 'You\'re modifying an existing page, not creating a new one.',
        type: 'multiple-choice',
        options: ['Create Page', 'Append Block', 'Update Page', 'Delete Page'],
        correctAnswer: 2,
        explanation: '"Update Page" modifies the properties of an existing Notion page. You provide the page ID and the new property values. Perfect for status updates and field changes.',
      },
      {
        id: 4,
        title: 'Generate an AI summary',
        instruction: 'You want to add an AI-generated summary of a Notion page\'s content. What\'s the correct workflow order?',
        hint: 'You need the content before you can summarize it.',
        type: 'ordering',
        items: [
          'Update Notion page with AI summary',
          'Notion: Get page content (blocks)',
          'OpenAI: Generate summary of page content',
          'Notion trigger: Page updated',
        ],
        correctOrder: [3, 1, 2, 0],
        explanation: 'Trigger (page updated) ‚Üí Get the page blocks (content) ‚Üí Send to OpenAI for summarization ‚Üí Update the page with the summary. Always fetch content before processing it.',
      },
      {
        id: 5,
        title: 'Handle Notion rate limits',
        instruction: 'Notion\'s API allows 3 requests per second. You\'re processing 30 pages. What should you add?',
        hint: 'You need to slow down the processing to respect rate limits.',
        type: 'config',
        configFields: [
          { label: 'Node to add', placeholder: 'Which node?', acceptedAnswers: ['Wait', 'Wait node', 'Delay'] },
          { label: 'Wait duration (ms)', placeholder: 'How long to wait?', acceptedAnswers: ['334', '400', '500', '1000'] },
        ],
        explanation: 'Add a Wait node with 334ms (1000ms / 3 requests = 333ms per request). This ensures you never exceed Notion\'s 3 requests/second limit.',
      },
    ],
    completionMessage: 'üìù Notion automation mastered! You can now build full knowledge management systems that update themselves automatically.',
  },

  {
    id: 'data-pipeline',
    title: 'Build a Real-Time Data Pipeline',
    description: 'Design a production-grade data pipeline: ingest ‚Üí transform ‚Üí validate ‚Üí store ‚Üí alert.',
    difficulty: 'Advanced',
    type: 'guided',
    timeLimit: 40,
    xp: 350,
    icon: '‚öôÔ∏è',
    steps: [
      {
        id: 1,
        title: 'Design the pipeline architecture',
        instruction: 'A data pipeline for processing e-commerce orders needs 5 stages. Put them in the correct order:',
        hint: 'Think: Receive ‚Üí Check ‚Üí Clean ‚Üí Store ‚Üí Notify.',
        type: 'ordering',
        items: [
          'Send Slack alert for high-value orders',
          'Webhook: Receive order from Shopify',
          'Validate: check required fields exist',
          'Transform: normalize currency, format dates',
          'Store: append to Airtable + PostgreSQL',
        ],
        correctOrder: [1, 2, 3, 4, 0],
        explanation: 'Receive ‚Üí Validate (before processing bad data) ‚Üí Transform (normalize) ‚Üí Store (persist) ‚Üí Alert (notify team). Validation before transformation prevents wasted processing.',
      },
      {
        id: 2,
        title: 'Data validation strategy',
        instruction: 'An incoming order is missing the "customer_email" field. What should your pipeline do?',
        hint: 'You shouldn\'t store invalid data, but you also shouldn\'t lose it.',
        type: 'multiple-choice',
        options: [
          'Store it anyway and fix manually later',
          'Drop the order silently',
          'Route to an "invalid" path: log to error sheet + alert team + don\'t process further',
          'Auto-fill with a placeholder email',
        ],
        correctAnswer: 2,
        explanation: 'Invalid data should be quarantined, not stored or dropped. Log it to an error sheet for manual review, alert the team, and stop further processing. This maintains data quality without losing orders.',
      },
      {
        id: 3,
        title: 'Idempotency ‚Äî preventing duplicates',
        instruction: 'Shopify sometimes sends the same webhook twice. How do you prevent duplicate orders in your database?',
        hint: 'Every Shopify order has a unique ID.',
        type: 'multiple-choice',
        options: [
          'Accept duplicates ‚Äî they\'re rare',
          'Check if the order ID already exists in the database before inserting',
          'Use a Set node to remove duplicates',
          'Limit the webhook to one call per minute',
        ],
        correctAnswer: 1,
        explanation: 'Before inserting, query your database: does this order ID exist? If yes, skip. If no, insert. This makes your pipeline "idempotent" ‚Äî running it twice produces the same result as running it once.',
      },
      {
        id: 4,
        title: 'Multi-destination storage',
        instruction: 'You need to store each order in 3 places simultaneously: Airtable, Google Sheets, and PostgreSQL. What\'s the most efficient approach?',
        hint: 'Parallel execution saves time.',
        type: 'multiple-choice',
        options: [
          'Store in Airtable ‚Üí then Sheets ‚Üí then PostgreSQL (sequential)',
          'Connect all 3 storage nodes to the same transform output (parallel)',
          'Pick one ‚Äî you don\'t need 3 databases',
          'Store in one and sync to others with a Schedule trigger',
        ],
        correctAnswer: 1,
        explanation: 'Connecting all 3 storage nodes to the same output runs them in parallel. Total time ‚âà slowest single storage operation instead of sum of all three. Always parallelize independent operations.',
      },
      {
        id: 5,
        title: 'Pipeline monitoring',
        instruction: 'Select all the metrics you should monitor for a production data pipeline:',
        hint: 'Think about reliability, performance, and data quality.',
        type: 'checkbox',
        checkboxOptions: [
          'Orders processed per hour',
          'Average processing time per order',
          'Error rate (% of failed orders)',
          'Duplicate detection count',
          'Database write success rate',
        ],
        correctChecks: [0, 1, 2, 3, 4],
        explanation: 'All 5 metrics matter! Volume shows capacity, latency shows performance, error rate shows reliability, duplicate count shows data quality, and write success rate shows storage health.',
      },
    ],
    completionMessage: '‚öôÔ∏è You\'ve designed a production-grade data pipeline! This architecture processes millions of records reliably. Companies pay $5,000-50,000 for systems like this.',
  },

  {
    id: 'ai-classifier',
    title: 'Build an AI Data Classifier',
    description: 'Create an intelligent classifier that uses AI to categorize, score, and route any incoming data.',
    difficulty: 'Advanced',
    type: 'guided',
    timeLimit: 35,
    xp: 325,
    icon: 'üß†',
    steps: [
      {
        id: 1,
        title: 'Design the classification schema',
        instruction: 'You\'re building a support ticket classifier. Your AI must return structured data. Which output format is best for automation?',
        hint: 'You need to parse the AI response programmatically.',
        type: 'multiple-choice',
        options: [
          'Plain text: "This is a billing issue"',
          'JSON: {"category": "billing", "priority": "high", "confidence": 0.92}',
          'A numbered list: 1. billing 2. high 3. 0.92',
          'Whatever the AI decides',
        ],
        correctAnswer: 1,
        explanation: 'JSON output is essential for automation. You can parse $json.category, $json.priority, and $json.confidence directly in the next nodes. Unstructured text requires complex parsing.',
      },
      {
        id: 2,
        title: 'Write the classification prompt',
        instruction: 'Fill in the key elements a classification prompt MUST include:',
        hint: 'Think: Who is the AI? What should it do? What output format?',
        type: 'config',
        configFields: [
          { label: 'AI Role (system prompt starts with)', placeholder: 'You are a...', acceptedAnswers: ['You are a', 'You are an', 'Act as a', 'You are a support ticket classifier'] },
          { label: 'Output instruction', placeholder: 'Respond with...', acceptedAnswers: ['Respond with JSON', 'Return JSON', 'Output JSON only', 'Respond only with valid JSON'] },
        ],
        explanation: 'Every classification prompt needs: (1) a clear role for the AI, (2) the categories to classify into, (3) an instruction to return only JSON. This produces reliable, parseable output.',
      },
      {
        id: 3,
        title: 'Parse the AI response',
        instruction: 'The OpenAI node returns the response in `$json.choices[0].message.content` as a JSON string. How do you access the "category" field from this?',
        hint: 'The response is a JSON string inside a JSON field ‚Äî you need to parse it first.',
        type: 'multiple-choice',
        options: [
          '{{ $json.choices[0].message.content.category }}',
          '{{ JSON.parse($json.choices[0].message.content).category }}',
          '{{ $json.category }}',
          '{{ $json.content.category }}',
        ],
        correctAnswer: 1,
        explanation: 'The content is a JSON string, not an object. You must first parse it: JSON.parse($json.choices[0].message.content) converts the string to an object, then .category gets the value.',
      },
      {
        id: 4,
        title: 'Route by classification',
        instruction: 'Based on the classification, tickets should go to different teams. Priority "critical" ‚Üí PagerDuty, Priority "high" ‚Üí Slack, Priority "normal" ‚Üí email. Which node handles 3 routes?',
        hint: 'Multiple routes need a specific node designed for this.',
        type: 'multiple-choice',
        options: ['IF Node (3 times)', 'Switch Node', 'Merge Node', 'Set Node'],
        correctAnswer: 1,
        explanation: 'The Switch Node handles multiple routing paths cleanly. Set cases: case "critical" ‚Üí path 1 (PagerDuty), case "high" ‚Üí path 2 (Slack), default ‚Üí path 3 (email).',
      },
      {
        id: 5,
        title: 'Measure classifier accuracy',
        instruction: 'To improve your classifier, you need to track when it\'s wrong. A support agent marks a ticket as "billing" but the AI said "technical". What should you log?',
        hint: 'You need to compare AI prediction vs. human correction.',
        type: 'checkbox',
        checkboxOptions: [
          'Original ticket text',
          'AI predicted category',
          'Human corrected category',
          'Confidence score from AI',
          'Timestamp of correction',
        ],
        correctChecks: [0, 1, 2, 3, 4],
        explanation: 'Log everything! This creates a "feedback dataset" you can use to fine-tune your prompt or switch to a better model. Tracking confidence helps identify which types of tickets the AI struggles with.',
      },
    ],
    completionMessage: 'üß† You\'ve built an intelligent AI classifier! Add it to any pipeline to make your automations smart. This is the foundation of AI-powered business systems.',
  },
];
